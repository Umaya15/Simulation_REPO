<html>
    <head>
        <script src="bundle.js"></script>
        <style>
            #renderCanvas {
                width: 25%;
                height: 25%;
                touch-action: none;
            }
        </style>
    </head>
    <body>
    <div class="elementCreator">
        <form id="setParameters">
            <label for="bodyname">Body Name</label><br>
            <input type="text" name="bodyname" maxlength="10" size="20"></input><br>\
            <label for="size">Diameter</label><br>
            <input type="number" name="size" size="20"></input><br>
            <label for="mass">mass</label><br>
            <input type="number" name="mass" size="10"></input><br>
            <label for="res">Resolution</label><br>
            <input type="number" name="res" size="10"></input>
            
            <h3>Position XYZ</h3>
            <input type="number" name="x" height="20"></input>
            <input type="number" name="y" size="10"></input>
            <input type="number" name="z" size="10"></input>

            <h3>Velocity</h3>
            <label for="speed">Axial speed</label><br>
            <input type="number" name="speed"></input><br>
            <label for="angle_xy">X-Y angle</label><br>
            <input type="number" name="angle_xy"></input><br>
            <label for="speed">Y-Z angle</label><br>
            <input type="number" name="angle_yz"></input><br>
            <button type="submit">Enter parameters</button>
        </form>
    </div>
    <div class="elementEditor"></div></div>
        
    <form id="editParameters" hidden>
        
        <label for="size">Diameter</label><br>
        <input type="number" name="size" size="20"></input><br>
        <label for="mass">Mass</label><br>
        <input type="number" name="mass" size="10"></input><br>
        <label for="res">Resolution</label><br>
        <input type="number" name="res" size="10"></input>
        
        <h3>Position XYZ</h3>
        <input type="number" name="x" height="20"></input>
        <input type="number" name="y" size="10"></input>
        <input type="number" name="z" size="10"></input>

        <h3>Velocity</h3>
        <label for="speed">Axial speed</label><br>
        <input type="number" name="speed"></input><br>
        <label for="angle_xy">X-Y angle</label><br>
        <input type="number" name="angle_xy"></input><br>
        <label for="speed">Y-Z angle</label><br>
        <input type="number" name="angle_yz"></input><br>
        <button type="submit">Save parameters</button>
    </form>
<div class="objects-list" id="objects-list">
    <h3>List of existing objects</h3>
    <div id="0">Object 1</div>
</div>
<canvas id="renderCanvas"></canvas>


<script>
let inputParameters = [];
let object; 
let objectCoordinate;
let objects = [];
let objectindex = 0;
let velocities = [];
let masses = [];

function axial_velocity(velocity, index) {
    if (!!velocity[1]) {veloX = velocity[0] * Math.cos(radians_degrees(velocity[1]))}
    else {veloX = velocities[index].x};
    if (!!velocity[1]) {veloY = velocity[0] * Math.sin(radians_degrees(velocity[1]))}
    else {veloY = velocities[index].y};
    if (!!velocity[2]) {veloZ = velocity[0] * Math.sin(radians_degrees(velocity[2]))}
    else {veloZ = velocities[index].z}
    velocities[index] = {x : veloX, y : veloY, z : veloZ};
}

function radians_degrees (input, path) {
    const pi = Math.PI;
    if (path == 0) {
        return input * (180/pi)}
    else {
        return pi * input/180 }};

function objectlist_gen (index) {
   let list = document.querySelector("#objects-list")
   let newclass = document.createElement("li");
   newclass.setAttribute("id", `${objectindex}`);
   let label = document.createElement("h4");
   label.innerHTML = (`Object ${index}`); 
   newclass.appendChild(label);
   list.appendChild(`#${objectindex}`);
   
/*alternate path:
let list = document.querySelector(".objects-list");
list.classList.add(classname);*/
}

function firstObject (scene) {
     objects[objectindex] = BABYLON.MeshBuilder.CreateSphere("Object 1", {diameter: 3, segments: 10}, scene);
     objects[objectindex].position = new BABYLON.Vector3(1, 1, 1);
     objectindex += 1};

function createObject (event) {
    const parameters = event.target;
    //const parameters = document.querySelector("#parameters");

    inputParameters[objectindex] = {};
    inputParameters[objectindex].diameter = parameters.elements["size"].value;
    if (parameters.elements["res"].value) {
        inputParameters[objectindex].segments = parameters.elements["res"].value}
    else {inputParameters[objectindex].segments = 32};
    console.log(inputParameters[objectindex]);

    bodyName = parameters.elements["bodyname"].value;
    objectCoordinate = new BABYLON.Vector3(parameters.elements["x"].value, parameters.elements["y"].value, parameters.elements["z"].value);
       
    objects[objectindex] = BABYLON.MeshBuilder.CreateSphere(bodyName, inputParameters[objectindex], scene);
    objects[objectindex].position = objectCoordinate;

    velo = [parameters.elements["speed"].value, parameters.elements["angle_xy"].value, parameters.elements["angle_yz"].value];
    axial_velocity(velo, objectindex);
    console.log(velocities);
    masses[objectindex] = parameters.elements["mass"].value;

    objectlist_gen((objectindex + 1));
    objectindex += 1;
    } 


const canvas = document.querySelector("#renderCanvas");
const engine = new BABYLON.Engine(canvas, true);
var scene = new BABYLON.Scene(engine);
const camera = new BABYLON.ArcRotateCamera("camera1", 1, 1, 1, new BABYLON.Vector3.Zero(), scene);
camera.attachControl(canvas, true);
const light = new BABYLON.HemisphericLight ("light1", new BABYLON.Vector3(1, 1, 1), scene); 
firstObject(scene);

document.addEventListener("DOMContentLoaded", function() {
    console.log("DOM loaded");
    let form1 = document.querySelector("#setParameters");
    console.log("looped");
    let form2 = document.querySelector("#editParameters");
    
    form1.addEventListener("submit", function() {
    event.preventDefault();
    createObject(event);
    console.log("function run");
    }) });

engine.runRenderLoop (function() {
    scene.render();
     console.log("rendered");
    });    

</script>
</body>
</html>